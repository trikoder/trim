import{_ as M,L as g,M as R,N as I,o as n,c as C,b as U,t as b,z as S,O as T,g as h,A as d,B as $,C as m,Q as w,m as f,w as N,U as B,h as F,d as k,V as P,W as A,I as p,X as D,q as y,Y as q,e as z,Z as i}from"./index-48ed5d0e.js";import{D as L}from"./dropzone-a7e6c739.js";const V={props:{uploadCaption:{type:String,required:!0},uploadUrl:{type:String,required:!0},clickableSelector:{type:String,default:".handle"},paramName:{type:String,default:"binary"},mediaType:{type:String,default:"image"},removePreviewOnUpload:{type:Boolean,default:!0},selectMultiple:{type:Boolean,default:!0},headers:Object,maxFiles:Number},mounted(){this.setupUpload()},beforeUnmount(){this.dropzone&&this.dropzone.destroy()},methods:{setupUpload(){const e=[].slice.call(this.$el.querySelectorAll(this.clickableSelector)),t=this.dropzone=new L(this.$el,{url:this.uploadUrl,params:this.mediaType&&{mediaType:this.mediaType},clickable:e.length?e:!0,maxFiles:this.maxFiles,paramName:this.paramName,headers:g(R({},I.defaults.headers.common,["Authorization"]),this.headers)});this.selectMultiple&&(t.hiddenFileInput.multiple=!0),t.on("sending",(o,r,l)=>{this.$emit("sending",{file:o,xhr:r,formData:l}),this.selectMultiple&&(t.hiddenFileInput.multiple=!0)}).on("success",(o,r)=>{this.$emit("upload",{file:o,response:r}),this.removePreviewOnUpload&&t.removeFile(o)}).on("error",(o,r)=>{this.$emit("uploadError",{file:o,errorMessage:r}),this.removePreviewOnUpload&&t.removeFile(o)})}}},H={class:"fileUploadType1"},Q={class:"handle iconUpload dz-clickable"};function O(e,t,o,r,l,a){return n(),C("div",H,[U("div",Q,b(o.uploadCaption),1)])}const K=M(V,[["render",O],["__file","fileUpload.vue"]]),c={components:{FileUpload:K,IncludedAdmin:P,Message:A},extends:T,data(){return{mapMediaTypeTo:"mediaType",uploadParameter:"binary",uploadHeaders:void 0,mediaTypes:["image"],uploadControls:[{caption:p("resourceControls.toIndex"),className:"withLeftIcon iconArrowLeft",action:()=>this.openIndex(this.indexQuery)},{isSaveControl:!0,caption:p("resourceControls.save"),className:"accented iconUploadCloud",action:()=>this.saveUploadedMedia()}],uploadUrl:function(){const e=D("baseApiUrl","/api/");return y.Model.extend({type:this.resourceName},{baseUrl:e}).url()+"/upload"},prepareModelFromUpload:(e,t)=>y.Model.getFromApi({url:e.xhr.getResponseHeader("Location")}),resolvedMediaTypes:[],uploadedIdentifiers:"",statusMessage:null}},computed:{isStandardEditContext(){return["edit"].concat(this.resolvedMediaTypes.reduce((t,o)=>(!o.hasUploadUi&&t.push(o.createContext),t),[])).indexOf(this.currentContext)>=0},currentResourceControls(){return this.currentContext!=="index"&&!this.isStandardEditContext?this.uploadControls.filter(e=>this.uploadedIdentifiers.length===0?!e.isSaveControl:!0):this.resourceControls},currentUploadConfig(){return q(this.resolvedMediaTypes,e=>e.createContext===this.currentContext)}},watch:{currentContext(){this.uploadedIdentifiers="",this.statusMessage=null}},created(){this.resolveMediaTypes(),this.setupMediaTypeMethods()},methods:{resolveMediaTypes(){this.resolvedMediaTypes=this.mediaTypes.map(e=>{const t=typeof e=="string"?{name:e}:e,o=t.name,r=z(i.space(o))+" "+p("baseMediaController.uploadCaption");return g({createPageTitle:r,createRouteName:["resource",this.resourceName,"create"+i.pascal(o)].join("."),uploadCaption:r,hasUploadUi:!0},t,{createContext:"create"+i.pascal(o)})})},setupMediaTypeMethods(){this.resolvedMediaTypes.forEach(e=>{const t="create"+i.pascal(e.name),o="open"+i.pascal(t),r="get"+i.pascal(t)+"Url",l="add"+i.pascal(t)+"Control";this[t]=function(a,u){this.resetContext(t,u),this.setPageTitle(e.createPageTitle),this.$emitter.emit("afterCreateSetup",{controller:this})},this[o]=function(a){return this.isExternal?this[t](null,a):new Promise(u=>{this.$emitter.once("afterCreateSetup",()=>u()),this.$router.navigateTo(this[r](a))})},this[r]=function(a){return this.$router.url({name:e.createRouteName,query:a})},this[l]=function(a){return this.addControl({caption:a||p("resourceControls.create"),url:this[r](),className:"accented iconEdit",action:()=>this[o]()})}})},getIndexConfigurator(){return e=>(this.resetResourceControls(),e.setTemplate("cards"),this.setupList({list:e,query:this.indexQuery}))},getEditConfigurator(){return e=>{this.resetResourceControls();let t;if(this.currentContext==="edit"){const o=e.resourceModel,r=typeof this.mapMediaTypeTo=="function"?this.mapMediaTypeTo(o):o.get(this.mapMediaTypeTo);t="setup"+i.pascal(r)+"Edit"}else t="setup"+this.currentContext.replace("create","")+"Edit";return this[t](g({query:this.currentQuery},e))}},processUploadedFile(e){this.prepareModelFromUpload(e.file,e.response).then(t=>{this.$refs.includedMedia.addNewIncludedItem(t)})},saveUploadedMedia(){return this.$refs.includedMedia.saveRelatedResources().then(()=>{window.scrollTo(0,0),this.statusMessage={text:p("baseResourceController.entitySavedMessage"),type:"messageType1"},this.$emit("resourcesUploadedAndUpdated",{models:this.$refs.includedMedia.models})}).catch(e=>{})}}};c.getDataKeys=()=>["mapMediaTypeTo","mediaTypes","uploadParameter","uploadHeaders","uploadControls","uploadUrl","prepareModelFromUpload"];c.toVueComponent=S({extends:c,dataKeys:T.getDataKeys().concat(c.getDataKeys())});const j=c,W={class:"layoutContainer"};function X(e,t,o,r,l,a){const u=h("message"),v=h("file-upload"),E=h("included-admin");return n(),C("div",{class:k(["resourceController",e.cssClass])},[(n(),d(m(e.toRawComponentProps(e.getResourceHeaderType())),{breadcrumbs:e.breadcrumbs,hasBottomBorder:e.headerHasBorder},{default:$(()=>[(n(),d(m(e.toRawComponentProps(e.getResourceControlsType())),{controls:e.currentResourceControls},null,8,["controls"]))]),_:1},8,["breadcrumbs","hasBottomBorder"])),e.currentContext==="index"?(n(),d(m(e.toRawComponentProps(e.getResourceListType())),{key:0,query:e.indexQuery,configure:e.getIndexConfigurator(),Collection:e.getCollectionType(),getEditUrl:e.getEditUrl,getIndexUrl:e.getIndexUrl,openEdit:e.openEdit,resourceCaption:e.resourceCaption,includedRelationships:e.includedRelationships.index,includedFields:e.includedFields.index,getEmptyListMessage:e.getEmptyListMessage,onQueryChange:e.openIndex,onBeforeConfigure:t[0]||(t[0]=s=>e.processIndexEvent("beforeConfigure",s)),onAfterConfigure:t[1]||(t[1]=s=>e.processIndexEvent("afterConfigure",s)),ref:"listHandler"},null,40,["query","configure","Collection","getEditUrl","getIndexUrl","openEdit","resourceCaption","includedRelationships","includedFields","getEmptyListMessage","onQueryChange"])):e.isStandardEditContext?(n(),d(m(e.toRawComponentProps(e.getResourceEditType())),{key:1,class:"resourceEdit resourceEditType1",ModelType:e.getModelType(),configure:e.getEditConfigurator(),resourceId:e.editResourceId,createRequiresDraft:e.createRequiresDraft,createRelatedStrategy:e.createRelatedStrategy,resourceSavedMessage:e.resourceSavedMessage,resourceCreatedMessage:e.resourceCreatedMessage,onBeforeConfigure:t[2]||(t[2]=s=>e.processConfigureEvent("beforeConfigure",s)),onAfterConfigure:t[3]||(t[3]=s=>e.processConfigureEvent("afterConfigure",s)),onResourceModelSaved:t[4]||(t[4]=s=>e.processSaveEvent(s)),ref:"editHandler"},null,40,["ModelType","configure","resourceId","createRequiresDraft","createRelatedStrategy","resourceSavedMessage","resourceCreatedMessage"])):(n(),C("div",{key:e.currentContext,class:"mediaUploadType1 resourceEdit resourceEditType1"},[e.statusMessage?(n(),d(u,w({key:0},e.statusMessage,{onClose:t[5]||(t[5]=s=>e.statusMessage=null)}),null,16)):f("",!0),U("div",W,[e.currentUploadConfig?(n(),d(v,{key:0,uploadCaption:e.currentUploadConfig.uploadCaption,mediaType:e.currentUploadConfig.name,uploadUrl:e.uploadUrl(),paramName:e.uploadParameter,headers:e.uploadHeaders,onUpload:e.processUploadedFile},null,8,["uploadCaption","mediaType","uploadUrl","paramName","headers","onUpload"])):f("",!0),N(F(E,{ref:"includedMedia",name:"uploadedIdentifiers",modelValue:e.uploadedIdentifiers,"onUpdate:modelValue":t[6]||(t[6]=s=>e.uploadedIdentifiers=s),setupEdit:e.getEditConfigurator(),removeItems:!1,addItems:!1,attributes:{wrapper:{class:"includedAdminBlockType1"},inputWrapper:{class:"includedAdminElement"}}},null,8,["modelValue","setupEdit"]),[[B,e.uploadedIdentifiers.length>0]])])]))],2)}const G=M(j,[["render",X],["__file","baseMediaResource.vue"]]);export{G as default};
