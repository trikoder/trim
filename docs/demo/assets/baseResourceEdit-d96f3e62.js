import{_ as c,y as h,o as i,b as p,z as u,A as f,B as l,l as m,n as g,C as y,D as C,G as b,H as s,m as E,R as T,I as v,J as S,K as n,d as R}from"./index-0c1d77fd.js";const o={mixins:[y,C,b],props:{isExternal:{type:Boolean,default:!1}},data:()=>({resourceModel:void 0,cssClass:void 0,navigationKey:void 0,includedRelationships:void 0,includedFields:void 0,resourceCreatedMessage:s("baseResourceController.entityCreatedMessage"),resourceSavedMessage:s("baseResourceController.entitySavedMessage"),breadcrumbs:[],resourceControls:[],currentQuery:{}}),created(){this.$emit("create",this),this.setNavSelected(),this.isExternal||(this.currentQuery=this.$route.query),this.bootstrapModel().catch(e=>this.handleEditSystemError(e))},mounted(){this.isExternal||this.$watch("$route",(e,r)=>{const t=e.query[this.getTabQueryKey()];this.$refs.editHandler&&(this.$refs.editHandler.selectedTab=t)})},methods:{bootstrapModel(){return Promise.resolve(this.getModel(this.getModelType())).then(e=>(this.resourceModel=e,e))},getModelType(){const e=this.includedRelationships,r=this.includedFields,t={},a={};return(e||r)&&(e&&(a.include=e),r&&(a.fields=r),t.url=function(){return this.constructor.url({type:this.getType(),id:this.get("id"),query:a})}),E.Model.extend(t)},getResourceControlsType(){return T},getResourceHeaderType(){return v},getResourceEditType(){return S},setNavSelected(){this.isExternal||this.$store.commit("setNavSelected",this.navigationKey)},addControl(e){return this.resourceControls.push(n({actionContext:this},e)),this},addSaveControl:function(e){return this.addControl({caption:e||s("resourceControls.save"),className:"accented iconUploadCloud",action:()=>this.$refs.editHandler.save().catch(r=>{this.$refs.editHandler.handleSaveError(r)})})},addDropdownControl:function(e){return Array.isArray(e)&&(e={items:e}),e.isDropdown=!0,e.items.forEach(r=>{r.actionContext=this}),this.resourceControls.push(e),this},setPageTitle(e){return this.setBreadcrumbs({caption:e}),this.isExternal||(window.document.title=this.formatWindowTitle(this.breadcrumbs,this.$store.state.projectCaption)),this},formatWindowTitle(e,r){return e.map(t=>t.caption).join(" / ")+" - "+r},setBreadcrumbs(e){return this.breadcrumbs=[e],this},getEditConfigurator(){return e=>(this.resetResourceControls(),this.setupEdit(n({query:this.currentQuery},e)))},processConfigureEvent(e,r){const t={beforeConfigure:"beforeEditSetup",afterConfigure:"afterEditSetup"};this.$emitter.emit(t[e],{controller:this,editHandler:r})},processSaveEvent(e){this.isExternal?this.$refs.editHandler&&(this.$refs.editHandler.$el.scrollTop=0):window.scrollTo(0,0),this.$emitter.emit("resourceSaved",e)},resetResourceControls(){return this.resourceControls=[],this},processTabSelect(e){this.isExternal||this.$router.navigateTo(n(this.getTabRoute(e),{useHistoryReplace:!0}))},getTabQueryKey(){return"tab"},getTabUrl(e){return this.$router.url(this.getTabRoute(e))},getTabRoute(e){return{name:this.$route.name,query:n({},this.currentQuery,{[this.getTabQueryKey()]:e})}},handleSystemError(e){throw R({message:s("validation.serverError"),acceptText:s("prompt.continueText"),acceptOnly:!0,parent:this}),e},handleEditSystemError(e){return this.handleSystemError(e)}}};o.getDataKeys=()=>["navigationKey","cssClass","includedRelationships","includedFields","resourceSavedMessage","resourceCreatedMessage"];o.toVueComponent=h({extends:o,dataKeys:o.getDataKeys()});const M=o;function $(e,r,t,a,w,B){return i(),p("div",{class:g(["resourceController",e.cssClass])},[(i(),u(l(e.toRawComponentProps(e.getResourceHeaderType())),{breadcrumbs:e.breadcrumbs,hasBottomBorder:e.headerHasBorder},{default:f(()=>[(i(),u(l(e.toRawComponentProps(e.getResourceControlsType())),{controls:e.resourceControls},null,8,["controls"]))]),_:1},8,["breadcrumbs","hasBottomBorder"])),e.resourceModel?(i(),u(l(e.toRawComponentProps(e.getResourceEditType())),{key:0,class:"resourceEdit resourceEditType1",ModelType:e.getModelType(),configure:e.getEditConfigurator(),model:e.resourceModel,resourceSavedMessage:e.resourceSavedMessage,resourceCreatedMessage:e.resourceCreatedMessage,initialSelectedTab:e.currentQuery.tab,getTabUrl:e.getTabUrl,onBeforeConfigure:r[0]||(r[0]=d=>e.processConfigureEvent("beforeConfigure",d)),onAfterConfigure:r[1]||(r[1]=d=>e.processConfigureEvent("afterConfigure",d)),onResourceModelSaved:e.processSaveEvent,onSelectTab:e.processTabSelect,onSystemError:e.handleEditSystemError,ref:"editHandler"},null,40,["ModelType","configure","model","resourceSavedMessage","resourceCreatedMessage","initialSelectedTab","getTabUrl","onResourceModelSaved","onSelectTab","onSystemError"])):m("",!0)],2)}const K=c(M,[["render",$],["__file","baseResourceEdit.vue"]]);export{K as default};
