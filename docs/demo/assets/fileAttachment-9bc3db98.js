import{_ as p,a4 as h,a5 as f,H as r,d as F,e as b,o as n,z as g,A as y,O as c,g as o,b as s,F as C,n as v,ai as z,t as u,l as d}from"./index-0c1d77fd.js";import{D as T}from"./dropzone-74b9b807.js";import{S as k}from"./simpleLightbox.min-a5da56bf.js";const _={elementType:"fileAttachment",components:{ElementWrapper:h},mixins:[f],props:{modelValue:{},acceptedFiles:{type:String},maxFileSize:{type:Number},mapThumbnailTo:{type:[String,Function]},mapCurrentFileUrlTo:{type:[String,Function]},addFileCaption:{type:String,default:()=>r("formElements.fileAttachment.addFileCaption")},changeFileCaption:{type:String,default:()=>r("formElements.fileAttachment.changeFileCaption")},downloadAction:{type:Function}},data:()=>({savesFile:!0,clientThumbnail:void 0,selectedFile:void 0}),computed:{thumbnailUrl(){return this.clientThumbnail?this.clientThumbnail:!this.selectedFile&&this.mapThumbnailTo?this.getModelMapping(this.mapThumbnailTo):void 0},fileUrl(){if(!this.selectedFile)return this.mapCurrentFileUrlTo?this.getModelMapping(this.mapCurrentFileUrlTo):void 0},selectedFileName(){return this.selectedFile&&this.selectedFile.name},textControlCaption(){return this.selectedFile||this.fileUrl?this.changeFileCaption:this.addFileCaption}},mounted(){this.$watch("isInteractive",t=>{t?this.setupFileInput():this.destroyFileInput()},{immediate:!0})},beforeUnmount(){this.lightbox&&this.lightbox.destroy(),this.destroyFileInput()},methods:{clickDownload(t){this.downloadAction&&(t.preventDefault(),this.downloadAction(this.fileUrl))},getModelMapping(t){return typeof t=="function"?t(this.resourceModel):this.resourceModel.get(t)},setupFileInput(){(this.dropzone=new T(this.$refs.inputWrapper,{url:"/dummy-upload-url",acceptedFiles:this.acceptedFiles,maxFilesize:this.maxFileSize,clickable:!0,maxFiles:1,uploadMultiple:!1,createImageThumbnails:!0,autoProcessQueue:!1,autoDiscover:!1,thumbnailWidth:800,thumbnailHeight:800,thumbnailMethod:"contain",previewsContainer:document.createElement("div")})).on("addedfile",i=>{this.clientThumbnail=void 0,this.selectedFile=i,this.dropzone.removeAllFiles()}).on("thumbnail",(i,a)=>{i===this.selectedFile&&(this.clientThumbnail=a)}).on("error",(i,a)=>{F({message:a,acceptText:r("prompt.continueText"),acceptOnly:!0,parent:this}),this.removeSelectedFile()})},destroyFileInput(){this.dropzone&&(this.dropzone.removeAllFiles(),this.dropzone.disable(),this.dropzone.destroy(),delete this.dropzone)},getFile(){return this.selectedFile},openFileDialog(){this.dropzone&&this.dropzone.hiddenFileInput.click()},zoomImage(){this.lightbox&&this.lightbox.destroy(),this.lightbox=k.open({items:[this.clientThumbnail||this.fileUrl],beforeUnmount:()=>{delete this.lightbox}})},removeSelectedFile(){this.selectedFile=this.clientThumbnail=void 0,this.dropzone.removeAllFiles()}}},U={class:"mediaContainer"},x=["src"],I={class:"textControls"},w={key:0,class:"fileName"},A=["href"];function D(t,i,a,S,B,e){const m=b("element-wrapper");return n(),g(m,c({renderInputWrapper:!1},t.elementWrapperProps),{default:y(()=>[o("div",c(t.inputWrapperAttributes,{ref:"inputWrapper"}),[o("div",U,[e.thumbnailUrl?(n(),s(C,{key:0},[o("img",{src:e.thumbnailUrl},null,8,x),o("button",{type:"button",onClick:i[0]||(i[0]=(...l)=>e.zoomImage&&e.zoomImage(...l)),class:"nBtn icr zoomInBtn iconMaximize"})],64)):(n(),s("button",{key:1,type:"button",onClick:i[1]||(i[1]=(...l)=>e.openFileDialog&&e.openFileDialog(...l)),class:v([{"iconFile large":t.selectedFile||e.fileUrl,iconPlus:!t.selectedFile&&!e.fileUrl},"nBtn fileUploadClickable placeholderImage icr"])},null,2))]),o("div",I,[o("span",{class:"fileUploadHandle",onClick:i[2]||(i[2]=(...l)=>e.openFileDialog&&e.openFileDialog(...l))},[z(u(e.textControlCaption)+" ",1),e.selectedFileName?(n(),s("span",w,u(e.selectedFileName),1)):d("",!0)])]),e.fileUrl&&!t.selectedFile?(n(),s("a",{key:0,href:e.fileUrl,onClick:i[3]||(i[3]=(...l)=>e.clickDownload&&e.clickDownload(...l)),target:"_blank",class:"downloadBtn nBtn icr iconDownload"},null,8,A)):d("",!0),t.selectedFile?(n(),s("button",{key:1,onClick:i[4]||(i[4]=l=>t.isInteractive&&e.removeSelectedFile()),type:"button",class:"removeBtn nBtn icr iconRotateCcw"})):d("",!0)],16)]),_:1},16)}const E=p(_,[["render",D],["__scopeId","data-v-507b5d36"],["__file","fileAttachment.vue"]]);export{E as default};
