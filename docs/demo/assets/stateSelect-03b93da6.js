import{_ as v,a4 as f,a5 as g,H as d,X as p,m as y,e as _,o as l,z as b,A as C,O as h,g as r,t as o,b as u,F as V,r as O,l as m}from"./index-58233bfe.js";const E={elementType:"stateSelect",components:{ElementWrapper:f},mixins:[g],props:{modelValue:[String,Boolean,Number],updateEntityOnChange:{type:Boolean,default:!1},updateControlCaption:{type:String,default:()=>d("formElements.stateSelect.updateControlCaption")},nextStatePlaceholderCaption:{type:String,default:()=>d("formElements.stateSelect.nextStatePlaceholderCaption")},states:{type:Array,required:!0,validator:e=>e.length>=2}},data(){return{currentState:this.getStateFromValue(this.modelValue)}},getInitialValue(e={}){return typeof e.value<"u"?e.value:e.states[0].value},created(){if(this.updateEntityOnChange&&(!this.resourceModel||this.resourceModel.isNew()))throw new Error("Existing resource model required for state select in live update mode")},beforeUpdate(){this.syncCurrentStateToModel()},computed:{selectableOptions(){if(this.currentState.transitions==="all"){const e=this.states.map(t=>this.getStateKey(t)).filter(t=>t!==this.getStateKey(this.currentState));return this.getTransitionsOptions(e)}else return this.getTransitionsOptions(this.currentState.transitions||[])},selectValue(){if(this.updateEntityOnChange){const e=p(this.selectableOptions,t=>t.value===this.modelValue);return e?e.value:this.selectableOptions.length&&this.selectableOptions[0].value}else return this.modelValue},selectCaption(){const e=p(this.selectableOptions,t=>t.value===this.selectValue);return e.value===this.currentState.value?this.nextStatePlaceholderCaption:e.caption},inputWrapperAttributes(){const e=this.normalizeAttributes(this.attributes.inputWrapper);return this.selectableOptions.length===0&&this.addToAttribute(e,"class","withNoOptions"),e}},methods:{processInputEvent(e){const t=this.states[0].value;let s=e.target.value;typeof t=="number"?s=parseFloat(s):typeof t=="boolean"&&(s=s==="true"),this.$emit("update:modelValue",s)},syncCurrentStateToModel(){if(this.resourceModel){const e=this.resourceModel.get(this.name);typeof e<"u"&&(this.currentState=this.getStateFromValue(e))}},getStateKey(e){return e.name||e.value},getStateFromValue(e){return p(this.states,t=>t.value===e)},persistState(){y.Model.create().setId(this.resourceModel.get("id")).setType(this.resourceModel.getType()).saveAttribute(this.name,this.selectValue).then(e=>{const t=e.get(this.name);this.resourceModel.setAttribute(this.name,t),this.$emit("update:modelValue",t),this.currentState=this.getStateFromValue(t)})},getTransitionsOptions(e=[]){const t=e.map(s=>{const i=this.states.find(c=>this.getStateKey(c)===s);return{caption:i.actionCaption||i.caption,value:i.value,key:i.value.toString()}});return!this.updateEntityOnChange&&t.length&&t.unshift({caption:this.currentState.caption,value:this.currentState.value,key:this.currentState.value.toString()}),t}}},k={class:"stateCaption"},M={key:0,class:"controls"},I={class:"selectContainer"},T={class:"select"},x={type:"button"},A=["value"],B=["value"];function w(e,t,s,i,c,a){const S=_("element-wrapper");return l(),b(S,h({renderInputWrapper:!1},e.elementWrapperProps),{default:C(()=>[r("div",h({class:"stateSelectElement"},a.inputWrapperAttributes),[r("p",k,[r("span",null,o(c.currentState.caption),1)]),a.selectableOptions.length&&e.isInteractive?(l(),u("div",M,[r("div",I,[r("div",T,[r("button",x,"↳  "+o(a.selectCaption),1),r("select",{value:a.selectValue,onInput:t[0]||(t[0]=(...n)=>a.processInputEvent&&a.processInputEvent(...n))},[(l(!0),u(V,null,O(a.selectableOptions,n=>(l(),u("option",{key:n.key,value:n.value},o(n.caption),9,B))),128))],40,A)])]),s.updateEntityOnChange?(l(),u("button",{key:0,type:"button",class:"updateBtn nBtn",onClick:t[1]||(t[1]=(...n)=>a.persistState&&a.persistState(...n))},o(s.updateControlCaption),1)):m("",!0)])):m("",!0)],16)]),_:1},16)}const N=v(E,[["render",w],["__scopeId","data-v-e4426d77"],["__file","stateSelect.vue"]]);export{N as default};
