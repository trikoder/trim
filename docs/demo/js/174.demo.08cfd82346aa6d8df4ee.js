(self.webpackChunk_trikoder_trim=self.webpackChunk_trikoder_trim||[]).push([[174],{7297:function(e,t,n){"use strict";n.r(t);var o=n(8081),i=n.n(o),s=n(3645),l=n.n(s)()(i());l.push([e.id,'.nestedSelectElement{display:inline-block;position:relative;box-sizing:border-box}.nestedSelectElement>.controls{transition:opacity .2s}.nestedSelectElement.hasOne>.controls>.item{font-size:1.6em;line-height:1.1428571429;display:inline-block;color:#303030}.nestedSelectElement.hasOne>.controls>.item>.removeBtn{font-size:.7142857143em;width:2em;height:2em;position:absolute;right:-0.8em;top:-0.8em;z-index:10}.nestedSelectElement.hasOne>.controls>.item>.removeBtn:before{content:"Ã—";width:1.4em;height:1.4em;line-height:1em;box-sizing:border-box;position:absolute;left:50%;top:50%;margin:-0.7em 0 0 -0.7em;color:rgba(0,0,0,.3);border:1px solid rgba(0,0,0,.15);border-radius:50%;background-color:#fff}.nestedSelectElement.hasOne>.controls>.item>.removeBtn:hover:before{box-shadow:0 .2em .5em rgba(0,0,0,.15)}@media screen and (min-width: 61.3125em){.nestedSelectElement.hasOne>.controls>.item{font-size:1.4em}}.nestedSelectElement.hasMany>.controls>.item{display:inline-block;font-size:1.2em;line-height:1.25;position:relative;padding:.1666666667em .5em .1666666667em 1.5em;margin:.4166666667em .4166666667em 0 0;vertical-align:middle;border-radius:.25em;border:1px solid #8f8f8f;cursor:auto;color:#fff;letter-spacing:.02em;background-color:#9c9c9c}.nestedSelectElement.hasMany>.controls>.item>.removeBtn{font-size:.8333333333em;position:absolute;left:0;top:50%;z-index:10;width:2em;line-height:2em;height:2em;margin-top:-1em;text-align:center;color:#fff;cursor:pointer}.nestedSelectElement .openBtn{font-size:1.6em;line-height:2.2857142857;text-align:left;padding:0 1.875em 0 .625em;display:block;width:100%}.nestedSelectElement .openBtn:before{font-size:1em;color:#e03431;left:auto;right:0;width:2.2em}@media screen and (min-width: 61.3125em){.nestedSelectElement .openBtn{font-size:1.4em;padding:0 2.1428571429em 0 .7142857143em}}.nestedSelectElement.hasItems{padding:0 2.6em .6em .5em}.nestedSelectElement.hasItems .openBtn{position:absolute;top:0;right:0;height:100%;width:100%}.nestedSelectElement>.dropdown{display:none;position:absolute;z-index:20;top:100%;left:-1px;right:-1px;margin:.5em 0 5em;min-width:20em;background:#fff;border:1px solid #ddd;box-shadow:0 .1em .3em rgba(0,0,0,.06);border-radius:.4em}.nestedSelectElement .itemList{overflow-x:hidden;overflow-y:auto;max-height:30em;padding:1em 0}.nestedSelectElement .itemList ul{border-left:1px solid #ddd;display:none}.nestedSelectElement .itemList ul.active{display:block;animation:slideDownFadeIn .15s}.nestedSelectElement .itemList li{position:relative;padding:0 0 0 2.5em}.nestedSelectElement .itemList .listItem{display:block;width:100%;font-size:1.4em;padding:.3571428571em .3571428571em .3571428571em .4285714286em;margin-left:-.4285714286em;line-height:1.4;cursor:auto;border-radius:.2142857143em;text-align:left}.nestedSelectElement .itemList .listItem.selectableItem{cursor:pointer}.nestedSelectElement .itemList .listItem.selectableItem:hover{color:#e03431;background-color:#f5f5f5}.nestedSelectElement .itemList .treeBtn{position:absolute;left:0;top:.2em;width:2.5em;height:2.5em;opacity:.3}.nestedSelectElement .itemList .treeBtn:before{font-size:1.2em}.nestedSelectElement .itemList .treeBtn:hover{color:#e03431;opacity:1}.nestedSelectElement .search{display:block;padding:0}.nestedSelectElement .search:before{font-size:1.4em;width:1.7857142857em;opacity:.3;top:-.3571428571em;margin-top:0}.nestedSelectElement .search>input{appearance:none;font-size:1.6em;color:#666;padding:.4375em;width:100%;padding-left:1.5625em;border:0;border-bottom:1px solid #ddd;background:rgba(0,0,0,0)}.nestedSelectElement .searchResults{overflow-x:hidden;overflow-y:auto;max-height:30em;padding:1em;display:none}.nestedSelectElement .searchResultItem,.nestedSelectElement .noSearchResults{display:block;width:100%;font-size:1.4em;box-sizing:border-box;padding:.3571428571em;line-height:1.4;cursor:pointer;border-radius:.2142857143em;text-align:left}.nestedSelectElement .searchResultItem.focused,.nestedSelectElement .searchResultItem.active,.nestedSelectElement .noSearchResults.focused,.nestedSelectElement .noSearchResults.active{color:#e03431;background-color:#f5f5f5}.nestedSelectElement .noSearchResults{opacity:.5;cursor:auto}.nestedSelectElement.loading>.controls{opacity:.5}.nestedSelectElement.loading .openBtn:before{animation:rotate .8s infinite}.nestedSelectElement.active>.dropdown{display:block;animation:slideDownFadeIn .15s}.nestedSelectElement.searchActive .itemList{display:none}.nestedSelectElement.searchActive .searchResults{display:block}',""]),t.default=l},3174:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return L}});var o=n(6252),i=n(3577),s=n(9963),l={class:"controls"},r=["onClick"],c={key:0,class:"dropdown"},a={class:"search iconSearch"},d=["placeholder"],u={key:0,class:"searchResults"},h=["innerHTML","onMouseover","onClick"],p={key:0,class:"noSearchResults"},m={class:"itemList"},f=n(7784),g=n(5511),v=n(7231),y={key:1,class:"active"},S={name:"tree-node",props:{model:Object,expandedResourceIds:Array,getModelCaption:Function,onExpand:Function,onCollapse:Function,onSelect:Function,isLeaf:Function,getModelChildren:Function,isLevelSelectable:Function},computed:{caption:function(){return this.getModelCaption(this.model)},selectable:function(){return this.isLevelSelectable(this.model)},expandable:function(){return!this.isLeaf(this.model)},expanded:function(){return this.expandedResourceIds.indexOf(this.model.get("id"))>=0},children:function(){return this.expandable&&this.expanded?this.getModelChildren(this.model):[]}},methods:{toggleNode:function(){this.expanded?this.onCollapse(this.model):this.onExpand(this.model)}}},b=n(3744);const C=(0,b.Z)(S,[["render",function(e,t,n,s,l,r){var c=(0,o.up)("tree-node",!0);return(0,o.wg)(),(0,o.iD)("li",null,[(0,o._)("button",{type:"button",onClick:t[0]||(t[0]=function(e){return n.onSelect(n.model)}),class:(0,i.C_)([{selectableItem:r.selectable},"nBtn listItem"])},(0,i.zw)(r.caption),3),r.expandable?((0,o.wg)(),(0,o.iD)("button",{key:0,onClick:t[1]||(t[1]=function(){return r.toggleNode&&r.toggleNode.apply(r,arguments)}),type:"button",class:(0,i.C_)(["treeBtn nBtn icr",r.expanded?"iconMinus":"iconPlus"])},null,2)):(0,o.kq)("",!0),r.expanded?((0,o.wg)(),(0,o.iD)("ul",y,[((0,o.wg)(!0),(0,o.iD)(o.HY,null,(0,o.Ko)(r.children,(function(e){return(0,o.wg)(),(0,o.j4)(c,{key:e.get("id"),model:e,expandedResourceIds:n.expandedResourceIds,getModelCaption:n.getModelCaption,onExpand:n.onExpand,onCollapse:n.onCollapse,onSelect:n.onSelect,isLeaf:n.isLeaf,isLevelSelectable:n.isLevelSelectable,getModelChildren:n.getModelChildren},null,8,["model","expandedResourceIds","getModelCaption","onExpand","onCollapse","onSelect","isLeaf","isLevelSelectable","getModelChildren"])})),128))])):(0,o.kq)("",!0)])}]]);var M=C,w=n(640),x=n(4017),E={elementType:"nestedSelect",components:{ElementWrapper:v.Z,TreeNode:M},mixins:[f.Z,x.Z],props:{modelValue:{type:String,default:""},mapCaptionTo:{type:[String,Function],default:"title"},mapSearchCaptionTo:{type:[String,Function]},mapParentTo:{type:[String,Function],default:"parent"},mapChildrenTo:{type:[String,Function],default:"children"},mapIsLeafTo:{type:[String,Function]},mapLevelTo:{type:[String,Function]},mapPositionTo:{type:[Function,String],default:function(){return 0}},selectableLevel:{type:[String,Array,Function],default:"leaf"},getCollectionType:{type:Function,default:function(){return w.F}},getModelType:{type:Function,default:function(){return w.H}},modelQuery:{type:Object},collectionQuery:{type:Object},select:{type:String,default:"one"},selectText:{type:String,default:function(){return(0,g.Z)("formElements.nestedSelect.selectText")}},searchPlaceholder:{type:String,default:function(){return(0,g.Z)("formElements.nestedSelect.searchPlaceholder")}}},data:function(){return{loading:!1,relatedModels:void 0,dropdownActive:!1,resourceCollection:void 0,searchQuery:"",searchResults:void 0,searchPosition:0,expandedResourceIds:[]}},computed:{resourceName:function(){return this.relation&&this.relation.resourceName||this.name},selectsOne:function(){return this.relation&&this.relation.type?"hasOne"===this.relation.type:"one"===this.select},sortComparator:function(){var e=this.mapPositionTo;return"function"==typeof e?e:function(t,n){return t.get(e)-n.get(e)}},rootResourceModels:function(){var e=this;return this.resourceCollection?this.resourceCollection.filter((function(t){return 0===e.getModelLevel(t)})).sort(this.sortComparator):[]},inputWrapperAttributes:function(){var e=this.normalizeAttributes(this.attributes.inputWrapper);return e.class=["nestedSelectElement",this.selectsOne?"hasOne":"hasMany",this.relatedModels&&"hasItems",this.dropdownActive&&"active",this.searchIsActive&&"searchActive",this.loading&&"loading",e.class||""].filter((function(e){return e})).join(" "),e},searchIsActive:function(){return this.searchQuery.length>0&&this.searchResults}},watch:{modelValue:"syncRelatedModels",searchQuery:"runSearch"},created:function(){this.syncRelatedModels()},methods:{getModelCaption:function(e){return"function"==typeof this.mapCaptionTo?this.mapCaptionTo(e):e.get(this.mapCaptionTo)},getModelSearchCaption:function(e){if(this.mapSearchCaptionTo)return"function"==typeof this.mapSearchCaptionTo?this.mapSearchCaptionTo(e):e.get(this.mapSearchCaptionTo)},expandNode:function(e){this.expandedResourceIds.push(e.get("id"))},collapseNode:function(e){this.expandedResourceIds=this.expandedResourceIds.filter((function(t){return t!==e.get("id")}))},selectModel:function(e){this.isLevelSelectable(e)&&(this.selectsOne?(this.relatedModels=[e],this.closeDropdown()):this.relatedModels?this.relatedModels.filter((function(t){return t.get("id")===e.get("id")})).length>0||this.relatedModels.push(e):this.relatedModels=[e],this.$emit("update:modelValue",this.relatedModels.map((function(e){return e.get("id")})).join(",")))},deselectModel:function(e){return this.relatedModels&&(this.relatedModels=this.relatedModels.filter((function(t){return t.get("id")!==e.get("id")})),0===this.relatedModels.length&&(this.relatedModels=void 0)),this.$emit("update:modelValue",this.relatedModels?this.relatedModels.map((function(e){return e.get("id")})).join(","):""),this},toggleDropdown:function(){this.dropdownActive?this.closeDropdown():this.openDropdown()},openDropdown:function(){var e=this;this.dropdownActive=!0,this.getResourceCollection().then((function(){return e.$nextTick()})).then((function(){return e.$refs.searchInput.focus()}))},closeDropdown:function(){this.dropdownActive=!1,this.searchPosition=0},isLevelSelectable:function(e){var t=this.selectableLevel;return"leaf"===t?this.isLeaf(e):"all"===t||(Array.isArray(t)?t.indexOf(this.getModelLevel(e))>=0:"function"==typeof t?t({model:e,nestedSelect:this}):void 0)},isLeaf:function(e){return this.mapIsLeafTo?"function"==typeof this.mapIsLeafTo?this.mapIsLeafTo(e,this.resourceCollection):e.get(this.mapIsLeafTo):0===this.getModelChildren(e).length},getModelLevel:function(e){if(this.mapLevelTo)return"function"==typeof this.mapLevelTo?this.mapLevelTo(e):e.get(this.mapLevelTo);var t=e.get(this.mapParentTo);return t?1+this.getModelLevel(t):0},getModelChildren:function(e){var t="function"==typeof this.mapChildrenTo?this.mapChildrenTo(e,this.resourceCollection):e.get(this.mapChildrenTo);return t?t.models?t.models:t:[]},syncRelatedModels:function(){var e=this,t=this.modelValue.split(",").filter((function(e){return e.length})),n=this.getModelType();if(0===t.length)return this.relatedModels=void 0,Promise.resolve(this.relatedModels);if(this.relatedModels&&this.areCollectionsAligned(t,this.relatedModels))return Promise.resolve(this.relatedModels);if(this.resourceModel){var o=this.resourceModel.get(this.name);if(o){var i=o.models||[o];if(this.areCollectionsAligned(t,i))return this.relatedModels=i,Promise.resolve(this.relatedModels)}}return this.loading=!0,Promise.all(t.map((function(t){return n.getFromApi({type:e.resourceName,id:t,query:e.modelQuery})}))).then((function(t){return e.loading=!1,e.relatedModels=t,t}))},areCollectionsAligned:function(e,t){var n=e.length===t.length,o=e.every((function(e){return 1===t.filter((function(t){return t.get("id")===e})).length}));return n&&o},getResourceCollection:function(){var e=this,t=this.getCollectionType();return this.resourceCollectionPromise||(this.loading=!0,this.resourceCollectionPromise=t.getFromApi({type:this.resourceName,query:this.collectionQuery}).then((function(t){return e.loading=!1,e.resourceCollection=t,t}))),this.resourceCollectionPromise},setupSearchEngine:function(){var e=this;return this.searchEnginePromise||(this.searchEnginePromise=n.e(221).then(n.bind(n,4221)).then((function(t){return new(0,t.default)(e.resourceCollection.filter((function(t){return e.isLevelSelectable(t)})).map((function(t){return{id:t.get("id"),caption:e.getModelCaption(t),searchCaption:e.getModelSearchCaption(t)}})),{keys:["caption"],threshold:.4})}))),this.searchEnginePromise},runSearch:function(){var e=this;clearTimeout(this.searchTimeout),0!==this.searchQuery.length&&(this.searchTimeout=setTimeout((function(){e.searchPosition=0,e.getResourceCollection().then((function(){return e.setupSearchEngine()})).then((function(t){e.searchResults=t.search(e.searchQuery).map((function(e,t){return e.item.selected=0===t,e.item}))}))}),100))},selectFocusedItem:function(){this.searchResults&&this.selectSearchResult(this.searchResults[this.searchPosition])},selectSearchResult:function(e){this.selectModel(this.resourceCollection.getModel(e.id))},focusNextResult:function(){this.focusSearchResult(this.searchPosition+1)},focusPrevResult:function(){this.focusSearchResult(this.searchPosition-1)},focusSearchResult:function(e){if(this.searchResults&&this.searchResults.length){var t=this.searchResults.length-1;e<0?e=t:e>t&&(e=0),this.searchPosition=e,this.searchResults.forEach((function(t,n){t.selected=n===e}))}}}};n(7295);const R=(0,b.Z)(E,[["render",function(e,t,n,f,g,v){var y=(0,o.up)("tree-node"),S=(0,o.up)("element-wrapper"),b=(0,o.Q2)("on-dismiss");return(0,o.wy)(((0,o.wg)(),(0,o.j4)(S,(0,i.vs)((0,o.F4)(e.elementWrapperProps)),{default:(0,o.w5)((function(){return[(0,o._)("div",l,[((0,o.wg)(!0),(0,o.iD)(o.HY,null,(0,o.Ko)(e.relatedModels,(function(t){return(0,o.wg)(),(0,o.iD)("div",{key:t.get("id"),class:"item"},[(0,o.Uk)((0,i.zw)(v.getModelCaption(t))+" ",1),e.isInteractive?((0,o.wg)(),(0,o.iD)("button",{key:0,type:"button",onClick:function(n){return e.isInteractive&&v.deselectModel(t)},class:"removeBtn iconClose icr nBtn"},null,8,r)):(0,o.kq)("",!0)])})),128)),(0,o._)("button",{type:"button",onClick:t[0]||(t[0]=function(t){return e.isInteractive&&v.toggleDropdown()}),class:(0,i.C_)(["openBtn nBtn",{iconMoreHorizontal:e.isInteractive}])},(0,i.zw)(n.modelValue?"":n.selectText),3)]),e.dropdownActive&&e.isInteractive&&!e.loading?((0,o.wg)(),(0,o.iD)("div",c,[(0,o._)("div",a,[(0,o.wy)((0,o._)("input",{type:"text",class:"searchInput","onUpdate:modelValue":t[1]||(t[1]=function(t){return e.searchQuery=t}),ref:"searchInput",placeholder:n.searchPlaceholder,onKeyup:[t[2]||(t[2]=(0,s.D2)((function(e){return v.focusNextResult()}),["down"])),t[3]||(t[3]=(0,s.D2)((function(e){return v.focusPrevResult()}),["up"]))],onKeydown:t[4]||(t[4]=(0,s.D2)((0,s.iM)((function(){return v.selectFocusedItem&&v.selectFocusedItem.apply(v,arguments)}),["prevent"]),["enter"]))},null,40,d),[[s.nr,e.searchQuery]]),e.searchResults?((0,o.wg)(),(0,o.iD)("div",u,[((0,o.wg)(!0),(0,o.iD)(o.HY,null,(0,o.Ko)(e.searchResults,(function(e,t){return(0,o.wg)(),(0,o.iD)("span",{key:e.id,class:(0,i.C_)(["searchResultItem",{focused:e.selected}]),innerHTML:e.searchCaption||e.caption,onMouseover:function(e){return v.focusSearchResult(t)},onClick:function(t){return v.selectSearchResult(e)}},null,42,h)})),128)),0===e.searchResults.length?((0,o.wg)(),(0,o.iD)("p",p,"No results")):(0,o.kq)("",!0)])):(0,o.kq)("",!0)]),(0,o._)("ul",m,[((0,o.wg)(!0),(0,o.iD)(o.HY,null,(0,o.Ko)(v.rootResourceModels,(function(t){return(0,o.wg)(),(0,o.j4)(y,{key:t.get("id"),model:t,expandedResourceIds:e.expandedResourceIds,getModelCaption:v.getModelCaption,onExpand:v.expandNode,onCollapse:v.collapseNode,onSelect:v.selectModel,isLeaf:v.isLeaf,isLevelSelectable:v.isLevelSelectable,getModelChildren:v.getModelChildren},null,8,["model","expandedResourceIds","getModelCaption","onExpand","onCollapse","onSelect","isLeaf","isLevelSelectable","getModelChildren"])})),128))])])):(0,o.kq)("",!0)]})),_:1},16)),[[b,{callback:v.closeDropdown,watch:e.dropdownActive}]])}]]);var L=R},7295:function(e,t,n){var o=n(7297);o.__esModule&&(o=o.default),"string"==typeof o&&(o=[[e.id,o,""]]),o.locals&&(e.exports=o.locals),(0,n(5346).Z)("70980b17",o,!0,{})}}]);