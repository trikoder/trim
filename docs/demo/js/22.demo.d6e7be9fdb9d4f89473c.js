(window.webpackJsonp=window.webpackJsonp||[]).push([[22],{323:function(e,t,n){var o=n(370);"string"==typeof o&&(o=[[e.i,o,""]]),o.locals&&(e.exports=o.locals);(0,n(4).default)("f28c6fb8",o,!0,{})},369:function(e,t,n){"use strict";var o=n(323);n.n(o).a},370:function(e,t,n){(t=n(3)(!1)).push([e.i,".nestedSelectElement{display:inline-block;position:relative;-webkit-box-sizing:border-box;box-sizing:border-box}.nestedSelectElement>.controls{-webkit-transition:opacity 0.2s;-o-transition:opacity 0.2s;transition:opacity 0.2s}.nestedSelectElement.hasOne>.controls>.item{font-size:1.6em;line-height:1.14286;display:inline-block;color:#303030}.nestedSelectElement.hasOne>.controls>.item>.removeBtn{font-size:.71429em;width:2em;height:2em;position:absolute;right:-0.8em;top:-0.8em;z-index:10}.nestedSelectElement.hasOne>.controls>.item>.removeBtn:before{content:'Ã—';width:1.4em;height:1.4em;line-height:1em;-webkit-box-sizing:border-box;box-sizing:border-box;position:absolute;left:50%;top:50%;margin:-0.7em 0 0 -0.7em;color:rgba(0,0,0,0.3);border:1px solid rgba(0,0,0,0.15);border-radius:50%;background-color:#fff}.nestedSelectElement.hasOne>.controls>.item>.removeBtn:hover:before{-webkit-box-shadow:0 0.2em 0.5em rgba(0,0,0,0.15);box-shadow:0 0.2em 0.5em rgba(0,0,0,0.15)}@media screen and (min-width: 61.3125em){.nestedSelectElement.hasOne>.controls>.item{font-size:1.4em}}.nestedSelectElement.hasMany>.controls>.item{display:inline-block;font-size:1.2em;line-height:1.25;position:relative;padding:.16667em .5em .16667em 1.5em;margin:.41667em .41667em 0 0;vertical-align:middle;border-radius:.25em;border:1px solid #8f8f8f;cursor:auto;color:#fff;letter-spacing:0.02em;background-color:#9c9c9c}.nestedSelectElement.hasMany>.controls>.item>.removeBtn{font-size:.83333em;position:absolute;left:0;top:50%;z-index:10;width:2em;line-height:2em;height:2em;margin-top:-1em;text-align:center;color:#fff;cursor:pointer}.nestedSelectElement .openBtn{font-size:1.6em;line-height:2.28571;text-align:left;padding:0 1.875em 0 .625em;display:block;width:100%}.nestedSelectElement .openBtn:before{font-size:1em;color:#e03431;left:auto;right:0;width:2.2em}@media screen and (min-width: 61.3125em){.nestedSelectElement .openBtn{font-size:1.4em;padding:0 2.14286em 0 .71429em}}.nestedSelectElement.hasItems{padding:0 2.6em 0.6em 0.5em}.nestedSelectElement.hasItems .openBtn{position:absolute;top:0;right:0;height:100%;width:100%}.nestedSelectElement>.dropdown{display:none;position:absolute;z-index:20;top:100%;left:-1px;right:-1px;margin:0.5em 0 5em;min-width:20em;background:#fff;border:1px solid #ddd;-webkit-box-shadow:0 0.1em 0.3em rgba(0,0,0,0.06);box-shadow:0 0.1em 0.3em rgba(0,0,0,0.06);border-radius:0.4em}.nestedSelectElement .itemList{overflow-x:hidden;overflow-y:auto;max-height:30em;padding:1em 0}.nestedSelectElement .itemList ul{border-left:1px solid #ddd;display:none}.nestedSelectElement .itemList ul.active{display:block;-webkit-animation:slideDownFadeIn 0.15s;animation:slideDownFadeIn 0.15s}.nestedSelectElement .itemList li{position:relative;padding:0 0 0 2.5em}.nestedSelectElement .itemList .listItem{display:block;width:100%;font-size:1.4em;padding:.35714em .35714em .35714em .42857em;margin-left:-.42857em;line-height:1.4;cursor:auto;border-radius:.21429em;text-align:left}.nestedSelectElement .itemList .listItem.selectableItem{cursor:pointer}.nestedSelectElement .itemList .listItem.selectableItem:hover{color:#e03431;background-color:#f5f5f5}.nestedSelectElement .itemList .treeBtn{position:absolute;left:0;top:0.2em;width:2.5em;height:2.5em;opacity:0.3}.nestedSelectElement .itemList .treeBtn:before{font-size:1.2em}.nestedSelectElement .itemList .treeBtn:hover{color:#e03431;opacity:1}.nestedSelectElement .search{display:block;padding:0}.nestedSelectElement .search:before{font-size:1.4em;width:1.78571em;opacity:0.3;top:-.35714em;margin-top:0}.nestedSelectElement .search>input{-webkit-appearance:none;-moz-appearance:none;appearance:none;font-size:1.6em;color:#666;padding:.4375em;width:100%;padding-left:1.5625em;border:0;border-bottom:1px solid #ddd;background:transparent}.nestedSelectElement .searchResults{overflow-x:hidden;overflow-y:auto;max-height:30em;padding:1em;display:none}.nestedSelectElement .searchResultItem,.nestedSelectElement .noSearchResults{display:block;width:100%;font-size:1.4em;-webkit-box-sizing:border-box;box-sizing:border-box;padding:.35714em;line-height:1.4;cursor:pointer;border-radius:.21429em;text-align:left}.nestedSelectElement .searchResultItem.focused,.nestedSelectElement .searchResultItem.active,.nestedSelectElement .noSearchResults.focused,.nestedSelectElement .noSearchResults.active{color:#e03431;background-color:#f5f5f5}.nestedSelectElement .noSearchResults{opacity:0.5;cursor:auto}.nestedSelectElement.loading>.controls{opacity:0.5}.nestedSelectElement.loading .openBtn:before{-webkit-animation:rotate 0.8s infinite;animation:rotate 0.8s infinite}.nestedSelectElement.active>.dropdown{display:block;-webkit-animation:slideDownFadeIn 0.15s;animation:slideDownFadeIn 0.15s}.nestedSelectElement.searchActive .itemList{display:none}.nestedSelectElement.searchActive .searchResults{display:block}\n",""]),e.exports=t},415:function(e,t,n){"use strict";n.r(t);var o=n(11),i=n(2),s=n(12),l={name:"tree-node",props:{model:Object,expandedResourceIds:Array,getModelCaption:Function,onExpand:Function,onCollapse:Function,onSelect:Function,isLeaf:Function,getModelChildren:Function,isLevelSelectable:Function},computed:{caption:function(){return this.getModelCaption(this.model)},selectable:function(){return this.isLevelSelectable(this.model)},expandable:function(){return!this.isLeaf(this.model)},expanded:function(){return this.expandedResourceIds.indexOf(this.model.get("id"))>=0},children:function(){return this.expandable&&this.expanded?this.getModelChildren(this.model):[]}},methods:{toggleNode:function(){this.expanded?this.onCollapse(this.model):this.onExpand(this.model)}}},r=n(1),a=Object(r.a)(l,(function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("li",[n("button",{staticClass:"nBtn listItem",class:{selectableItem:e.selectable},attrs:{type:"button"},on:{click:function(t){return e.onSelect(e.model)}}},[e._v(e._s(e.caption))]),e._v(" "),e.expandable?n("button",{class:["treeBtn nBtn icr",e.expanded?"iconMinus":"iconPlus"],attrs:{type:"button"},on:{click:e.toggleNode}}):e._e(),e._v(" "),e.expanded?n("ul",{staticClass:"active"},e._l(e.children,(function(t){return n("tree-node",{key:t.get("id"),attrs:{model:t,expandedResourceIds:e.expandedResourceIds,getModelCaption:e.getModelCaption,onExpand:e.onExpand,onCollapse:e.onCollapse,onSelect:e.onSelect,isLeaf:e.isLeaf,isLevelSelectable:e.isLevelSelectable,getModelChildren:e.getModelChildren}})})),1):e._e()])}),[],!1,null,null,null).exports,c=n(16),d=n(18),u=n.n(d),h={elementType:"nestedSelect",components:{ElementWrapper:s.a,TreeNode:a},mixins:[o.a,u.a],props:{value:{type:String,default:""},mapCaptionTo:{type:[String,Function],default:"title"},mapSearchCaptionTo:{type:[String,Function]},mapParentTo:{type:[String,Function],default:"parent"},mapChildrenTo:{type:[String,Function],default:"children"},mapIsLeafTo:{type:[String,Function]},mapLevelTo:{type:[String,Function]},mapPositionTo:{type:[Function,String],default:function(){return 0}},selectableLevel:{type:[String,Array,Function],default:"leaf"},getCollectionType:{type:Function,default:function(){return c.a}},getModelType:{type:Function,default:function(){return c.b}},modelQuery:{type:Object},collectionQuery:{type:Object},select:{type:String,default:"one"},selectText:{type:String,default:function(){return Object(i.a)("formElements.nestedSelect.selectText")}},searchPlaceholder:{type:String,default:function(){return Object(i.a)("formElements.nestedSelect.searchPlaceholder")}}},data:function(){return{loading:!1,relatedModels:void 0,dropdownActive:!1,resourceCollection:void 0,searchQuery:"",searchResults:void 0,searchPosition:0,expandedResourceIds:[]}},computed:{resourceName:function(){return this.relation&&this.relation.resourceName||this.name},selectsOne:function(){return this.relation&&this.relation.type?"hasOne"===this.relation.type:"one"===this.select},sortComparator:function(){var e=this.mapPositionTo;return"function"==typeof e?e:function(t,n){return t.get(e)-n.get(e)}},rootResourceModels:function(){var e=this;return this.resourceCollection?this.resourceCollection.filter((function(t){return 0===e.getModelLevel(t)})).sort(this.sortComparator):[]},inputWrapperAttributes:function(){var e=this.normalizeAttributes(this.attributes.inputWrapper);return e.class=["nestedSelectElement",this.selectsOne?"hasOne":"hasMany",this.relatedModels&&"hasItems",this.dropdownActive&&"active",this.searchIsActive&&"searchActive",this.loading&&"loading",e.class||""].filter((function(e){return e})).join(" "),e},searchIsActive:function(){return this.searchQuery.length>0&&this.searchResults}},watch:{value:"syncRelatedModels",searchQuery:"runSearch"},created:function(){this.syncRelatedModels()},methods:{getModelCaption:function(e){return"function"==typeof this.mapCaptionTo?this.mapCaptionTo(e):e.get(this.mapCaptionTo)},getModelSearchCaption:function(e){if(this.mapSearchCaptionTo)return"function"==typeof this.mapSearchCaptionTo?this.mapSearchCaptionTo(e):e.get(this.mapSearchCaptionTo)},expandNode:function(e){this.expandedResourceIds.push(e.get("id"))},collapseNode:function(e){this.expandedResourceIds=this.expandedResourceIds.filter((function(t){return t!==e.get("id")}))},selectModel:function(e){if(this.isLevelSelectable(e)){if(this.selectsOne)this.relatedModels=[e],this.closeDropdown();else if(this.relatedModels){this.relatedModels.filter((function(t){return t.get("id")===e.get("id")})).length>0||this.relatedModels.push(e)}else this.relatedModels=[e];this.$emit("input",this.relatedModels.map((function(e){return e.get("id")})).join(","))}},deselectModel:function(e){return this.relatedModels&&(this.relatedModels=this.relatedModels.filter((function(t){return t.get("id")!==e.get("id")})),0===this.relatedModels.length&&(this.relatedModels=void 0)),this.$emit("input",this.relatedModels?this.relatedModels.map((function(e){return e.get("id")})).join(","):""),this},toggleDropdown:function(){this.dropdownActive?this.closeDropdown():this.openDropdown()},openDropdown:function(){var e=this;this.dropdownActive=!0,this.getResourceCollection().then((function(){return e.$nextTick()})).then((function(){return e.$refs.searchInput.focus()}))},closeDropdown:function(){this.dropdownActive=!1,this.searchPosition=0},isLevelSelectable:function(e){var t=this.selectableLevel;return"leaf"===t?this.isLeaf(e):"all"===t||(Array.isArray(t)?t.indexOf(this.getModelLevel(e))>=0:"function"==typeof t?t({model:e,nestedSelect:this}):void 0)},isLeaf:function(e){return this.mapIsLeafTo?"function"==typeof this.mapIsLeafTo?this.mapIsLeafTo(e,this.resourceCollection):e.get(this.mapIsLeafTo):0===this.getModelChildren(e).length},getModelLevel:function(e){if(this.mapLevelTo)return"function"==typeof this.mapLevelTo?this.mapLevelTo(e):e.get(this.mapLevelTo);var t=e.get(this.mapParentTo);return t?1+this.getModelLevel(t):0},getModelChildren:function(e){var t="function"==typeof this.mapChildrenTo?this.mapChildrenTo(e,this.resourceCollection):e.get(this.mapChildrenTo);return t?t.models?t.models:t:[]},syncRelatedModels:function(){var e=this,t=this.value.split(",").filter((function(e){return e.length})),n=this.getModelType();if(0===t.length)return this.relatedModels=void 0,Promise.resolve(this.relatedModels);if(this.relatedModels&&this.areCollectionsAligned(t,this.relatedModels))return Promise.resolve(this.relatedModels);if(this.resourceModel){var o=this.resourceModel.get(this.name);if(o){var i=o.models||[o];if(this.areCollectionsAligned(t,i))return this.relatedModels=i,Promise.resolve(this.relatedModels)}}return this.loading=!0,Promise.all(t.map((function(t){return n.getFromApi({type:e.resourceName,id:t,query:e.modelQuery})}))).then((function(t){return e.loading=!1,e.relatedModels=t,t}))},areCollectionsAligned:function(e,t){var n=e.length===t.length,o=e.every((function(e){return 1===t.filter((function(t){return t.get("id")===e})).length}));return n&&o},getResourceCollection:function(){var e=this,t=this.getCollectionType();return this.resourceCollectionPromise||(this.loading=!0,this.resourceCollectionPromise=t.getFromApi({type:this.resourceName,query:this.collectionQuery}).then((function(t){return e.loading=!1,e.resourceCollection=t,t}))),this.resourceCollectionPromise},setupSearchEngine:function(){var e=this;return this.searchEnginePromise||(this.searchEnginePromise=n.e(3).then(n.t.bind(null,402,7)).then((function(t){return new(0,t.default)(e.resourceCollection.filter((function(t){return e.isLevelSelectable(t)})).map((function(t){return{id:t.get("id"),caption:e.getModelCaption(t),searchCaption:e.getModelSearchCaption(t)}})),{keys:["caption"],threshold:.4})}))),this.searchEnginePromise},runSearch:function(){var e=this;clearTimeout(this.searchTimeout),0!==this.searchQuery.length&&(this.searchTimeout=setTimeout((function(){e.searchPosition=0,e.getResourceCollection().then((function(){return e.setupSearchEngine()})).then((function(t){e.searchResults=t.search(e.searchQuery).map((function(e,t){return e.selected=0===t,e}))}))}),100))},selectFocusedItem:function(){this.searchResults&&this.selectSearchResult(this.searchResults[this.searchPosition])},selectSearchResult:function(e){this.selectModel(this.resourceCollection.getModel(e.id))},focusNextResult:function(){this.focusSearchResult(this.searchPosition+1)},focusPrevResult:function(){this.focusSearchResult(this.searchPosition-1)},focusSearchResult:function(e){if(this.searchResults&&this.searchResults.length){var t=this.searchResults.length-1;e<0?e=t:e>t&&(e=0),this.searchPosition=e,this.searchResults.forEach((function(t,n){t.selected=n===e}))}}}},p=(n(369),Object(r.a)(h,(function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("element-wrapper",e._b({directives:[{name:"on-dismiss",rawName:"v-on-dismiss",value:{callback:e.closeDropdown,watch:e.dropdownActive},expression:"{callback: closeDropdown, watch: dropdownActive}"}]},"element-wrapper",e.elementWrapperProps,!1),[n("div",{staticClass:"controls"},[e._l(e.relatedModels,(function(t){return n("div",{key:t.get("id"),staticClass:"item"},[e._v("\n            "+e._s(e.getModelCaption(t))+"\n            "),e.isInteractive?n("button",{staticClass:"removeBtn iconClose icr nBtn",attrs:{type:"button"},on:{click:function(n){e.isInteractive&&e.deselectModel(t)}}}):e._e()])})),e._v(" "),n("button",{staticClass:"openBtn nBtn",class:{iconMoreHorizontal:e.isInteractive},attrs:{type:"button"},on:{click:function(t){e.isInteractive&&e.toggleDropdown()}}},[e._v(e._s(e.value?"":e.selectText))])],2),e._v(" "),e.dropdownActive&&e.isInteractive&&!e.loading?n("div",{staticClass:"dropdown"},[n("div",{staticClass:"search iconSearch"},[n("input",{directives:[{name:"model",rawName:"v-model",value:e.searchQuery,expression:"searchQuery"}],ref:"searchInput",staticClass:"searchInput",attrs:{type:"text",placeholder:e.searchPlaceholder},domProps:{value:e.searchQuery},on:{keyup:[function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"down",40,t.key,["Down","ArrowDown"])?null:e.focusNextResult()},function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"up",38,t.key,["Up","ArrowUp"])?null:e.focusPrevResult()}],keydown:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:(t.preventDefault(),e.selectFocusedItem(t))},input:function(t){t.target.composing||(e.searchQuery=t.target.value)}}}),e._v(" "),e.searchResults?n("div",{staticClass:"searchResults"},[e._l(e.searchResults,(function(t,o){return n("span",{key:t.id,staticClass:"searchResultItem",class:{focused:t.selected},domProps:{innerHTML:e._s(t.searchCaption||t.caption)},on:{mouseover:function(t){return e.focusSearchResult(o)},click:function(n){return e.selectSearchResult(t)}}})})),e._v(" "),0===e.searchResults.length?n("p",{staticClass:"noSearchResults"},[e._v("No results")]):e._e()],2):e._e()]),e._v(" "),n("ul",{staticClass:"itemList"},e._l(e.rootResourceModels,(function(t){return n("tree-node",{key:t.get("id"),attrs:{model:t,expandedResourceIds:e.expandedResourceIds,getModelCaption:e.getModelCaption,onExpand:e.expandNode,onCollapse:e.collapseNode,onSelect:e.selectModel,isLeaf:e.isLeaf,isLevelSelectable:e.isLevelSelectable,getModelChildren:e.getModelChildren}})})),1)]):e._e()])}),[],!1,null,null,null));t.default=p.exports}}]);