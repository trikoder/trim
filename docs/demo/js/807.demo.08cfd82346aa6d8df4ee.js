"use strict";(self.webpackChunk_trikoder_trim=self.webpackChunk_trikoder_trim||[]).push([[807],{807:function(e,t,i){i.r(t);var o=i(640);t.default={resourceName:"category",extendsController:"BaseNestedResource",mapParentTo:"parentCategory",mapChildrenTo:"childCategories",mapPositionTo:"position",setupList:function({list:e}){this.addControl({caption:"Create new category",className:"accented iconEdit",action:()=>this.openCreate({position:e.rootResourceModels.length+1})}),e.addFilter("TextFormElement",{name:"title",label:"Title"}),e.addFilter("NestedSelectFormElement",{name:"parentCategory",label:"Parent category",mapCaptionTo:"title",mapParentTo:"parentCategory",mapChildrenTo:"childCategories",mapPositionTo:"position",selectableLevel:"all",relation:{resourceName:"category"}}),e.addMassAction([{caption:"Publish",updateAttributes:{published:!0}},{caption:"Unpublish",updateAttributes:{published:!1}}]),e.addItem("LinkListItem",{caption:"Title",mapTo:"title",action:"editItem"}),e.addItem("TextListItem",{caption:"Description",mapTo:"description"}),e.addItem("BlipListItem",{caption:"Published",mapTo:"published",addIf:this.screenIsLarge}),e.addItem("ContextMenuListItem",{caption:"Actions",items:t=>this.setupListContextMenu(e,t)})},setupEdit:function({edit:e,method:t,query:i}){this.addToIndexControl().addSaveControl(),e.addField("TextFormElement",{label:"Title",name:"title",attributes:{input:{class:"inputType2 size2"}},layoutReference:"mainRegion"}),e.addField("TextareaFormElement",{label:"Description",name:"description",layoutReference:"mainRegion"}),e.addField("FileAttachmentFormElement",{label:"Image",name:"image",mapThumbnailTo:"imageThumbnailUrl",mapCurrentFileUrlTo:"imageOriginalUrl",layoutReference:"mainRegion"}),e.addField("NestedSelectFormElement",{readOnly:"edit"===t,modelValue:"4",name:"parentCategory",label:"Parent category",mapCaptionTo:"title",mapParentTo:"parentCategory",mapChildrenTo:"childCategories",mapPositionTo:"position",selectableLevel:"all",relation:{type:"hasOne",resourceName:"category"},hint:"edit"===t?"Existing category parent cannot be updated":"",layoutReference:"sideRegion"}),e.addField("SelectFormElement",{label:"Published status",name:"published",selectOptions:[{caption:"Published",value:!0},{caption:"Not published",value:!1}],layoutReference:"sideRegion"}),e.addField("HiddenFormElement",{name:"position",addIf:"create"===t,value:i.position?parseInt(i.position,10):1})},setupListContextMenu(e,t){const i=t.get("id"),a=t.get("parentCategory"),n=t.get("childCategories"),l=a?a.get("childCategories").models.sort(((e,t)=>e.getAttribute("position")-t.getAttribute("position"))):e.rootResourceModels,r=l.map(((e,t)=>({id:e.get("id"),position:t+1}))),s=r.find((e=>e.id===i)).position,d=r.map((e=>e.position)),p=Math.min.apply(Math,d),c=Math.max.apply(Math,d),m=(e,t)=>o.H.extend({type:"category"}).create().setId(e.get("id")).saveAttribute("position",t).then((()=>{e.setAttribute("position",t)})),u=e=>Promise.all(l.map(((e,t)=>e.get("position")!==t+1?m(e,t+1):null))).then((()=>{const i=t.get("position"),o=i+e,a=l.find((e=>e.get("position")===o));return Promise.all([m(t,o),m(a,i)])})),g=[{caption:"Edit category",url:e=>this.getEditUrl({id:i}),action:e=>this.openEdit({id:i})},{caption:"Add subcategory",url:e=>this.getCreateUrl({parentCategoryId:i,position:n?n.length+1:1}),action:e=>this.openCreate({parentCategoryId:i,position:n?n.length+1:1})}];return s>p&&g.push({caption:"Move up",action:(e,t)=>(t.close(),u(-1))}),s<c&&g.push({caption:"Move down",action:(e,t)=>(t.close(),u(1))}),g}}}}]);